<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <!--
      File: marrival.html
      
      Programmers:
      Jivani Cassar, UMass Lowell Student (jivani_cassar@student.uml.edu)
      Daniel Brook, UMass Lowell student (daniel_brook@student.uml.edu)
      Austin Veino, UMass Lowell Student (austin_veino@student.uml.edu)
      
      Page updated by Daniel Brook on 2013-03-30 at 9:00 AM
      
      Description:
      This page is where the arrival time data will be rendered for the mobile
      interface. To simplify data requests and save bandwidth, only ONE line
      worth of data will be displayed. This also makes sense for the user, who
      will have likely navigated to this page using the line selector.
      
      The following URL parameters are needed for this page to function:
        name=""   - The station name as provided in lib/stations.js
        line=""   - The line for which data is desired (as formatted in 
                    lib/stations.js). 
      
      Note: if no line parameter is passed, then a selection tool should appear
            that allows the user to select which line they want arrivals for.
    -->
    
    <meta content="width=device-width, minimum-scale=1, maximum-scale=1" name="viewport">

    <!-- Pull in internal resources for populating data -->
    <link rel="stylesheet" href="css/default/jquery.mobile-1.3.0.min.css"/>
    <script src="lib/jquery-1.9.1.min.js"></script>
    <script src="lib/jquery.mobile-1.3.0.min.js"></script>
    
    <script src="lib/jhmformutils.js" type="text/javascript"></script>
    <script src="lib/structures.js" type="text/javascript"></script>
    <script src="lib/stations.js" type="text/javascript"></script>
    <script src="lib/green.js" type="text/javascript"></script>
    <script src="lib/datagetter.js" type="text/javascript"></script>
    <script src="lib/mobileUI.js" type="text/javascript"></script>
    
    <title>Mass TRAC Mobile</title>
    
    <script>
    $(document).ready( function() {
      
      /*
       * Before doing much else with the page, we need to determine how much
       * information is present. If the URL has the line parameter, then
       * it's just a simple matter of fetching data and rendering the page,
       * but if not, then a list of lines the stop at the selected station
       * should be presented.
       */
      var sname = (getParameter( "name" )).split("%20").join(" ");
      var sline = getParameter( "line" );
      
      if (sname == null && sline == null) {
        
        ///////////////////////////////////////////////////////////////////////
        /// Replace this alert box with something more substantial...
        ///////////////////////////////////////////////////////////////////////
        alert( "No station and line selected" );
        return;
        
      } else if (sline == null) {
        
        ///////////////////////////////////////////////////////////////////////
        /// Replace this alert box with something more substantial...
        ///////////////////////////////////////////////////////////////////////
        alert( "Select a line to see upcoming arrivals" );
        return;
      }
      
      /*
       * If both data points were provided, then do a lookup to be sure that
       * the name is a valid one (conforming to stations.js).
       */
      var staObj = masstrac.lookupStation( sname );
      
      if (staObj == false) {
        alert( "Invalid station name specified" );
        return;
      }
      
      // Place the name of the station onto the page
      $("#nameZone").html( staObj.name );
      
      // Assign click handler to the reload data button
      $("#refresher").click( function () {
        reloadData( staObj.name, sline );
      });
      
      // Otherwise, the station lookup was good, fetch the data
      reloadData( staObj.name, sline );
    });
  </script>
  </head>
  <body>
    
    <header data-role="header" data-position="inline">
      
      <!-- 
      LET THEM EAT... a regular link. The back button behavior on these jQuery
      Mobile pages is insane and usually leads to a bunch of 404/NOT FOUND
      errors when pressed, so instead, provide a back button that just goes
      to the mobile index page. 
      
      (This is only a stop-gap measure)
      -->
      
      <a href="mselectindex.html" data-ajax="false" data-icon="back">Selection</a>
      <h1>Arrivals</h1>
      <a href="#" id="refresher" data-icon="refresh">Refresh</a>
    </header>
    
    <ul data-role="listview">
      <li id="nameZone"></li>
      <li id="timeZone"></li>
    </ul>
    
    
    <br />
    
    <!-- Dynamic content place-holders -->
    <ul id="arrivalList" data-role="listview"></ul>
    
  </body>
</html>
